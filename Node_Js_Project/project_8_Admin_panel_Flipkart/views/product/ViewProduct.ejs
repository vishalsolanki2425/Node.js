<%- include('../header') %>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <div class="page-wrapper">
        <!-- ============================================================== -->
        <!-- Bread crumb -->
        <!-- ============================================================== -->
        <div class="page-breadcrumb">
            <div class="row">
                <div class="col-12 d-flex no-block align-items-center">
                    <h4 class="page-title">View Products</h4>
                    <div class="ml-auto text-right">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="/">Home</a></li>
                                <li class="breadcrumb-item active" aria-current="page">View Product</li>
                            </ol>
                        </nav>
                    </div>
                </div>
            </div>

            <style>
                .filter-bar {
                    background: white;
                    border-radius: 12px;
                    padding: 20px;
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
                    margin-bottom: 25px;
                }

                .filter-btn {
                    background: var(--light);
                    border: 1px solid var(--light-gray);
                    border-radius: 20px;
                    padding: 8px 20px;
                    font-size: 14px;
                    color: var(--dark);
                    transition: all 0.3s;
                }

                .filter-btn:hover,
                .filter-btn.active {
                    background: var(--primary);
                    color: white;
                    border-color: var(--primary);
                }

                .no-products {
                    text-align: center;
                    font-size: 1.2rem;
                    color: #6c757d;
                    margin-top: 40px;
                }
            </style>

            <div class="products-section mb-4">
                <div class="d-flex justify-content-between mb-4 flex-wrap gap-2">
                    <!-- Price Dropdown -->
                    <div class="d-flex gap-2 align-items-center" style="max-width: 400px;">
                        <select id="price-filter" class="form-select" style="width: 180px;">
                            <option value="all">All Prices</option>
                            <option value="0-500">₹0 - ₹500</option>
                            <option value="501-1000">₹501 - ₹1000</option>
                            <option value="1001-5000">₹1001 - ₹5000</option>
                            <option value="5001-10000">₹5001 - ₹10000</option>
                            <option value="10001-9999999">₹10001+</option>
                        </select>
                    </div>

                    <!-- Search Input -->
                    <div class="search-container d-flex gap-2" style="max-width: 300px;">
                        <input type="text" id="product-search" class="search-box" placeholder="Search products...">
                        <button class="btn btn-success" id="search-btn">Search</button>
                    </div>
                </div>

                <!-- Category Filter -->
                <div class="filter-bar">
                    <div class="filter-options">
                        <button class="filter-btn active" data-category="all">All</button>
                        <button class="filter-btn" data-category="Mobiles & Tablets">Mobiles & Tablets</button>
                        <button class="filter-btn" data-category="Fashion">Fashion</button>
                        <button class="filter-btn" data-category="Electronics">Electronics</button>
                        <button class="filter-btn" data-category="Home & Furniture">Home & Furniture</button>
                        <button class="filter-btn" data-category="TVs & Appliances">TVs & Appliances</button>
                        <button class="filter-btn" data-category="Beauty & Personal Care">Beauty & Personal
                            Care</button>
                        <button class="filter-btn" data-category="Grocery">Grocery</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Grid -->
        <div class="container-fluid">
            <div class="row" id="products-container">
                <% product.forEach((product, i)=> { %>
                    <div class="col-lg-3 col-md-4 col-sm-6 mb-4 product-item"
                        data-name="<%= product.name.toLowerCase() %>"
                        data-category="<%= product.categoryname.categoryname.toLowerCase() %>"
                        data-price="<%= product.price %>">
                        <div class="card border-0 shadow-lg h-100 rounded-3 overflow-hidden"
                            style="transition:all .3s ease;">
                            <!-- Product Image -->
                            <div
                                style="height:220px; margin: 10px; display:flex; align-items:center; justify-content:center;">
                                <% if (product.productimage) { %>
                                    <img src="<%= product.productimage %>" alt="<%= product.name %>"
                                        style="max-height:100%; max-width:100%; object-fit:contain;">
                                    <% } else { %>
                                        <span class="text-muted">No Image</span>
                                        <% } %>
                            </div>

                            <!-- Card Body -->
                            <div class="card-body d-flex flex-column p-3">
                                <h5 class="card-title text-dark fw-bold mb-2" style="font-size:1.1rem;">
                                    <%= product.name %>
                                </h5>

                                <h6 class="fw-bold text-success mt-2 mb-3">₹ <%= product.price %>
                                </h6>

                                <p class="text-secondary mb-2" style="min-height:50px;">
                                    <strong>Description:</strong>
                                    <% if (product.description && product.description.length> 120) { %>
                                        <%= product.description.substring(0, 120) %>...
                                            <% } else { %>
                                                <%= product.description %>
                                                    <% } %>
                                </p>

                                <p class="mb-1"><strong>Category:</strong>
                                    <%= product.categoryname.categoryname %>
                                </p>

                                <div class="mt-auto d-flex justify-content-between">
                                    <a href="/product/editproduct/<%= product._id %>"
                                        class="btn btn-sm btn-outline-primary rounded-circle" title="Edit">
                                        <i class="far fa-edit"></i>
                                    </a>
                                    <a href="/product/singleproductview/<%= product._id %>"
                                        class="btn btn-sm btn-outline-info rounded-circle" title="View">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="/product/deleteproduct/<%= product._id %>"
                                        class="btn btn-sm btn-outline-danger rounded-circle" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <% }) %>
            </div>

            <div class="no-products" id="no-products" style="display:none;">
                No products found.
            </div>
        </div>
    </div>

    <script>
        const searchInput = document.getElementById('product-search');
        const searchBtn = document.getElementById('search-btn');
        const priceFilter = document.getElementById('price-filter');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const products = document.querySelectorAll('.product-item');
        const noProductsMsg = document.getElementById('no-products');

        function filterProducts() {
            const query = searchInput.value.trim().toLowerCase();
            const activeCategoryBtn = document.querySelector('.filter-btn.active');
            const activeCategory = activeCategoryBtn.dataset.category.toLowerCase();
            const priceRange = priceFilter.value;

            let anyVisible = false;

            products.forEach(product => {
                const name = product.dataset.name;
                const category = product.dataset.category;
                const price = parseFloat(product.dataset.price);

                const matchesSearch = name.includes(query) || query === '';
                const matchesCategory = activeCategory === 'all' || category === activeCategory;

                let matchesPrice = true;
                if (priceRange !== 'all') {
                    const [min, max] = priceRange.split('-').map(Number);
                    matchesPrice = price >= min && price <= max;
                }

                const show = matchesSearch && matchesCategory && matchesPrice;
                product.style.display = show ? 'block' : 'none';
                if (show) anyVisible = true;
            });

            noProductsMsg.style.display = anyVisible ? 'none' : 'block';

            searchInput.value = '';
        }

        searchBtn.addEventListener('click', filterProducts);
        searchInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') filterProducts();
        });
        priceFilter.addEventListener('change', filterProducts);

        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                filterProducts();
            });
        });
    </script>

    <%- include('../footer') %>