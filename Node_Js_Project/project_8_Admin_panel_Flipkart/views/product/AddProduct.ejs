<%- include('../header') %>

<div class="page-wrapper">
    <div class="page-breadcrumb">
        <div class="row">
            <div class="col-12 d-flex no-block align-items-center">
                <h4 class="page-title">Add Product</h4>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <form action="/product/addproduct" method="post" enctype="multipart/form-data">
                        <div class="card-body">
                            <h4 class="card-title">Product Information</h4>

                            <!-- Product Name -->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Product Name</label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control" name="name" placeholder="Enter Product Name" required>
                                </div>
                            </div>

                            <!-- Description -->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Description</label>
                                <div class="col-sm-9">
                                    <textarea class="form-control" name="description" rows="3" placeholder="Enter Product Description"></textarea>
                                </div>
                            </div>

                            <!-- Category -->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Category</label>
                                <div class="col-sm-9">
                                    <select class="form-control" name="categoryname" id="categorySelect" required>
                                        <option value="">Select Category</option>
                                        <% category.forEach(cat => { %>
                                            <option value="<%= cat._id %>"><%= cat.categoryname %></option>
                                        <% }) %>
                                    </select>
                                </div>
                            </div>

                            <!-- Subcategory -->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Sub Category</label>
                                <div class="col-sm-9">
                                    <select class="form-control" name="subcategoryname" id="subcategorySelect" required>
                                        <option value="">Select Sub Category</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Extra Category -->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Extra Category</label>
                                <div class="col-sm-9">
                                    <select class="form-control" name="extracategoryname" id="extraCategorySelect">
                                        <option value="">Select Extra Category</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Price -->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Price</label>
                                <div class="col-sm-9">
                                    <input type="number" class="form-control" name="price" placeholder="Enter Price" required>
                                </div>
                            </div>

                            <!-- Image -->
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Product Image</label>
                                <div class="col-sm-9">
                                    <input type="file" class="form-control" name="productimage" required>
                                </div>
                            </div>

                        </div>

                        <div class="card-body">
                            <button type="submit" class="btn btn-primary">Add Product</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<%- include('../footer') %>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const categorySelect = document.getElementById("categorySelect");
    const subcategorySelect = document.getElementById("subcategorySelect");
    const extraCategorySelect = document.getElementById("extraCategorySelect");

    categorySelect.addEventListener("change", async () => {
        const categoryId = categorySelect.value;

        subcategorySelect.innerHTML = "<option value=''>Select Sub Category</option>";
        extraCategorySelect.innerHTML = "<option value=''>Select Extra Category</option>";

        if (!categoryId) return;

        try {
            const subRes = await fetch(`/product/getSubcategories?categoryId=${categoryId}`);
            const subData = await subRes.json();
            subData.subcategories.forEach(sub => {
                let opt = document.createElement("option");
                opt.value = sub._id;
                opt.textContent = sub.subcategoryname;
                subcategorySelect.appendChild(opt);
            });

            const extraRes = await fetch(`/product/getExtraCategories?categoryId=${categoryId}`);
            const extraData = await extraRes.json();
            extraData.extracategories.forEach(extra => {
                let opt = document.createElement("option");
                opt.value = extra._id;
                opt.textContent = extra.extracategoryname;
                extraCategorySelect.appendChild(opt);
            });

        } catch (err) {
            console.error("Error fetching categories:", err);
        }
    });
});
</script>